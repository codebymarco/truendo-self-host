<!DOCTYPE html>
<html>
  <head>
    <script>
      window.TruSettings = {
        siteid: "19582bfd-aaf2-43de-b9ab-edd2ec303ada",
        custom_url: "true",
        custom_url_value: "truendo",
        tru_headless: "true",
      };
    </script>
    <script
      id="truendoAutoBlock"
      type="text/javascript"
      src="./truendo/pc/truendo_cmp.pid.js"
    ></script>
    <title>Styled Privacy Panel</title>
    <link rel="stylesheet" href="/index.css" />
  </head>
  <body>
    <nav>
      <h1>stade vein</h1>
      <div>
        <a href="/privacy.html">cookie settings</a>
        <a href="/">home</a>
        <a href="/about.html">about</a>
      </div>
    </nav>
    <a href="/privacy.html">cookie settings</a>
    <iframe
      data-cy="the-frame-youtube"
      width="900"
      height="500"
      src="./www.youtube.com/embed.html"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
    ></iframe>

    <div id="cc-banner" style="display: none">
      <h3>Your Privacy</h3>
      <p>
        We use cookies to improve your experience on our site and to show you
        personalized ads. Click [ACCEPT] to accept all cookies, [NECESSARY ONLY]
        to accept only the necessary cookies, or [MY OPTIONS] to find out more
        about the use of cookies and to change your cookie preferences.
      </p>
      <button type="button" onclick="javascript:Truendo.openCookieSettings()">
        My Options
      </button>
      <button
        type="button"
        onclick="javascript:Truendo.acceptNecessaryCookiesOnly()"
      >
        Necessary Only
      </button>
      <button type="button" onclick="javascript:Truendo.acceptAllCookies()">
        Accept
      </button>
    </div>

    <div class="custom-panel" id="custom-panel">
      <div class="custom-panel-header">
        <div class="panel-close-icon" onclick="Truendo.HideCustomPanel()"></div>
        <h1>Panel Heading</h1>
      </div>
      <div class="custom-panel-content">
        <div class="privacy-id">
          <div class="privacy-id-label">Privacy ID</div>
          <div class="privacy-id-value" id="privacyid"></div>
        </div>

        <div class="policy-links">
          <div class="policy-link" id="cookiepolicy"></div>
          <div class="policy-link" id="privacypolicy"></div>
        </div>

        <div id="catsServicesContainer"></div>

        <div class="custom-panel-action-buttons">
          <button type="button" onclick="Truendo.necClosePanel()">
            Necessary Only
          </button>
          <button type="button" onclick="Truendo.acceptAllClosePanel()">
            Accept
          </button>
          <button type="button" id="changes" onclick="saveSettingsAndClose()">
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <div class="custom-panel-button" id="custom-panel-button">
      <button onclick="OpenCustomPanelUsingCustomButton()">
        Privacy Settings
      </button>
    </div>

    <script>
      function saveSettingsAndClose() {
        Truendo.SaveSettingsClosePanel();
      }

      function OpenCustomPanelUsingCustomButton() {
        Truendo.ShowCustomPanel();
        displayData();

        // Display Privacy ID
        const container = document.getElementById("privacyid");
        if (container && window.Truendo?.privacyID) {
          const id = window.Truendo.privacyID();
          container.innerHTML = id
            ? "Privacy ID: " + id
            : "Privacy ID not available";
        }

        // Display policy links
        Truendo.displayCookiePolicy();
        Truendo.displayPrivacyPolicy();
      }
    </script>

    <script>
      // track changes made on panel before saving changes
      let changes = false;
      let myMap = new Map();
      myMap.set("statistics", true);
      myMap.set("marketing", true);
      myMap.set("social_content", true);
      myMap.set("add_features", true);
      function catToggled(cat) {
        let currentValue = myMap.get(cat);
        myMap.set(cat, !currentValue);
        changes = true;
        const panel = document.getElementById("changes");
        if (panel) {
          panel.style.display = "block";
        }
      }
    </script>

    <script>
      // display data onto the panel
      function displayData() {
        const catsAndServices = Truendo.getCatsAndServices();
        if (!catsAndServices) return;

        const container = document.getElementById("catsServicesContainer");
        container.innerHTML = "";

        catsAndServices.forEach((category) => {
          container.appendChild(createCategoryElement(category));
        });
      }

      function createCategoryElement(category) {
        const categoryDiv = createElement("div", {
          className: category.cat === "necessary" ? "category-necessary" : "",
        });

        // Create header with title and toggle
        const headerDiv = createElement("div", {
          className: "category-header",
        });

        const titleElement = createElement("h2", { text: category.name });
        headerDiv.appendChild(titleElement);

        // Add toggle switch for non-necessary categories
        if (category.cat !== "necessary") {
          const toggleContainer = createElement("label", {
            className: "toggle-switch",
          });

          const toggleInput = createElement("input", {
            type: "checkbox",
            checked: category.state === "active",
            events: {
              change: (e) => {
                Truendo.toggleCat(category);
                catToggled(category.cat);
              },
            },
          });

          const toggleSlider = createElement("span", {
            className: "toggle-slider",
          });

          toggleContainer.appendChild(toggleInput);
          toggleContainer.appendChild(toggleSlider);
          headerDiv.appendChild(toggleContainer);
        } else {
          // For necessary categories, show a disabled toggle that's always on
          const toggleContainer = createElement("label", {
            className: "toggle-switch",
          });

          const toggleInput = createElement("input", {
            type: "checkbox",
            checked: true,
            disabled: true,
          });

          const toggleSlider = createElement("span", {
            className: "toggle-slider",
          });

          toggleContainer.appendChild(toggleInput);
          toggleContainer.appendChild(toggleSlider);
          headerDiv.appendChild(toggleContainer);
        }

        categoryDiv.appendChild(headerDiv);

        categoryDiv.appendChild(
          createElement("p", {
            text: `Description: ${category.desc || ""}`,
          })
        );

        categoryDiv.appendChild(createServicesList(category.services));

        return categoryDiv;
      }

      function createServicesList(services) {
        const serviceList = createElement("ul");

        services.forEach((service) => {
          const serviceItem = createElement("li");
          const hasCookies =
            Array.isArray(service.cookies) && service.cookies.length > 0;

          const header = createElement("div", {
            className: "service-header",
            style: {
              cursor: hasCookies ? "pointer" : "default",
            },
          });

          const headerText = `${service.name} (Activity: ${service.activity_name})`;
          header.textContent = headerText;

          let cookieBox = null;
          if (hasCookies) {
            const arrow = createElement("span", {
              className: "service-arrow",
              html: "▶",
            });

            header.appendChild(arrow);

            cookieBox = createElement("div", {
              className: "cookie-box",
            });

            service.cookies.forEach((cookie) => {
              const cookieItem = createElement("div", {
                className: "cookie-item",
                text: cookie.name,
              });
              cookieBox.appendChild(cookieItem);
            });

            header.addEventListener("click", () => {
              const isOpen = cookieBox.style.display === "block";
              cookieBox.style.display = isOpen ? "none" : "block";
              arrow.innerHTML = isOpen ? "▶" : "▼";
            });
          }

          serviceItem.appendChild(header);
          if (cookieBox) serviceItem.appendChild(cookieBox);

          serviceList.appendChild(serviceItem);
        });

        return serviceList;
      }

      function createElement(tag, options = {}) {
        const element = document.createElement(tag);

        if (options.text) {
          element.textContent = options.text;
        }

        if (options.html) {
          element.innerHTML = options.html;
        }

        if (options.className) {
          element.className = options.className;
        }

        if (options.style) {
          Object.assign(element.style, options.style);
        }

        if (options.type) {
          element.type = options.type;
        }

        if (options.checked !== undefined) {
          element.checked = options.checked;
        }

        if (options.disabled) {
          element.disabled = options.disabled;
        }

        if (options.events) {
          Object.entries(options.events).forEach(([event, handler]) => {
            element.addEventListener(event, handler);
          });
        }

        return element;
      }

      function displayCookiePolicyLink(link) {
        const container = document.getElementById("cookiepolicy");
        if (container && link) {
          container.innerHTML = `Cookie Policy: <a href="${link}" target="_blank" rel="noopener noreferrer">${link}</a>`;
        }
      }

      function displayPrivacyPolicyLink(link) {
        const container = document.getElementById("privacypolicy");
        if (container && link) {
          container.innerHTML = `Privacy Policy: <a href="${link}" target="_blank" rel="noopener noreferrer">${link}</a>`;
        }
      }
    </script>

    <script>
      // Helper function to handle common operations
      function updatePrivacyDisplay() {
        displayData();
        const container = document.getElementById("privacyid");
        if (container && window.Truendo?.privacyID) {
          const id = window.Truendo.privacyID();
          container.innerHTML = id
            ? "Privacy ID: " + id
            : "Privacy ID not available";
        }
      }

      // Helper function to check consent status
      function hasValidConsent() {
        try {
          const cookie = decodeURIComponent(
            document.cookie
              .split("; ")
              .find((row) => row.startsWith("truendo_cmp="))
              .split("=")[1]
          );
          const consent = JSON.parse(cookie);
          return consent.ack === true;
        } catch (e) {
          console.warn("Consent cookie missing or invalid:", e);
          return false;
        }
      }

      window.TruendoEventCallback = (ev) => {
        const eventHandlers = {
          show_custom_panel: () => {
            Truendo.ShowCustomPanel();
            updatePrivacyDisplay();
          },
          close_custom_panel: () => {
            Truendo.HideCustomPanel();
            updatePrivacyDisplay();
          },
          tru_panel_open: () => {
            if (hasValidConsent()) {
              return;
            }
            Truendo.ShowCustomPanel();
            updatePrivacyDisplay();
          },
          banner_showing: () => {
            Truendo.HideCustomButton();
          },
          banner_gone: () => {
            Truendo.ShowCustomButton();
          },
        };

        if (eventHandlers[ev.name]) {
          eventHandlers[ev.name]();
        }
      };
    </script>

    <iframe
      width="200px"
      height="200px"
      data-src="https://www.youtube.com/embed/PUoQQwHHZFs"
      title="Are You on Track to ACHIEVE Your 2025 Goals? - Motivational Speech"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen
      src="https://prod-origin.truendo.com/pc/placeholder/v2/en.html?domain=demo.truendo.com&service_name=YouTube&category_id=social_content&service_id=google_youtube&mode=2&font_color=%23000000&bg_color=%23FFF&btn_color=%23508DFA"
      truendo="true"
      data-trucookiecontrol="social_content"
    ></iframe>

    <iframe
      width="200px"
      height="200px"
      frameborder="0"
      scrolling="no"
      marginheight="0"
      truendo="true"
      data-trucookiecontrol="add_features"
      marginwidth="0"
      src="https://prod-origin.truendo.com/pc/placeholder/v2/en.html?domain=demo.truendo.com&service_name=YouTube&category_id=social_content&service_id=google_youtube&mode=2&font_color=%23000000&bg_color=%23FFF&btn_color=%23508DFA"
      data-src="https://maps.google.com/maps?width=100%25&amp;height=600&amp;hl=en&amp;q=1%20Grafton%20Street,%20Dublin,%20Ireland+(My%20Business%20Name)&amp;t=&amp;z=14&amp;ie=UTF8&amp;iwloc=B&amp;output=embed"
      ><a
        href="https://www.mapsdirections.info/calcular-la-población-en-un-mapa"
        >Mapa de población interactivo</a
      ></iframe
    >
    <script>
      
      function setupButtonVisibilityWatcher() {
        const banner = document.getElementById("cc-banner");
        const button = document.getElementById("custom-panel-button");

        if (!banner || !button) return;

        // Function to update button based on banner state
        const updateButton = () => {
          const bannerVisible =
            window.getComputedStyle(banner).display !== "none";
          const hasConsent = checkIfConsentGiven();

          button.style.display =
            bannerVisible && !hasConsent ? "none" : "block";
        };

        // Watch for changes to banner
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (
              mutation.type === "attributes" &&
              mutation.attributeName === "style"
            ) {
              updateButton();
            }
          });
        });

        observer.observe(banner, {
          attributes: true,
          attributeFilter: ["style"],
        });

        // Initial check
        updateButton();
      }


      function checkIfConsentGiven() {
        try {
          const cookie = document.cookie
            .split("; ")
            .find((row) => row.startsWith("truendo_cmp="));

          if (cookie) {
            const consent = JSON.parse(
              decodeURIComponent(cookie.split("=")[1])
            );
            return consent.ack === true;
          }
        } catch (e) {
          console.warn("Could not check consent cookie:", e);
        }
        return false;
      }

      // Initialize when DOM is ready
      document.addEventListener(
        "DOMContentLoaded",
        setupButtonVisibilityWatcher
      );
    </script>
  </body>
</html>
